## Docker란

- **도커 : 컨테이너의 변하지 않는 설정을 다른 컴퓨터에서도 쓰기 쉽게하기 위해 사용?
  이미지 : 라이브러리 등을 압축하여 이미지화한 것**
- 도커는 ’/usr/bin/docker’ 에 위치 , 하지만 실제 도커 엔진의 프로세스를 확인하면 ‘usr/bin/dockerd’ 파일로 실행됨
- 즉, 컨테이너나 이미지를 다루는 명령어는 /usr/bin/docker에서 실행되지만 도커 엔진의 프로세스는 /usr/bin/dockerd 파일로 실행 → docker의 명령어가 실제 도커 엔진이 아닌 클라이언트로서의 도구이기 때문
- 도커는 기본적으로 유닉스 도메인 소켓을 이용해서 통신을 한다. 소켓의 주소는 unix:///var/run/docker.socket 으로 root만 사용할 수 있다.
  ```tsx
  // 사용시 터미널에서 루트로 연결해야함
  su root
  ```

## Docker 구조

- 크게 2가지로 하나는 클라이언트로서의 도커이고, 다른 하나는 서버로서의 도커로 분류
- 컨테이너를 생성하고 실행하며 이미지를 관리하는 주체는 서버도커이고, 이는 dockerd 프로세스로서 동작
- 도커 엔진은 외부에서 API 입력을 받아 도커 엔진의 기능을 수행하는데, 도커 프로세스가 실행되어 서버로서 입력을 받을 준비가 된 상태를 **도커 데몬**이라 함
- 도커 데몬은 API 입력을 받아 도커 엔진의 기능을 수행하는데, 이 API를 사용할 수 있도록 CLI(Command Line Interface)를 제공하는 것이 도커 클라이언트
- 사용자가 docker로 시작하는 명령어를 입력하면 도커 클라이언트를 사용하는 것, 도커 클라이언트는 입력된 명령어를 로컬에 존재하는 도커 데몬에게 API로서 전달 → 이때 도커 클라이언트는 /var/run/docker.sock에 위치한 유닉스 소켓을 통해 도커 데몬의 API를 호출
- 도커 제어 과정 (터미널 or PuTTY에서 도커가 설치된 호스트에 접속해 docker 명령어 입력)
  1. 도커 명령어 ( ex) docker ps )를 입력
  2. /usr/bin/docker는 /var/run/docker.sock 유닉스 소켓을 사용해 도커 데몬에게 명령어 전달
  3. 도커 데몬은 이 명령어를 파싱하고 명령어에 해당하는 작업 수행
  4. 수행 결과를 도커 클라이언트에 반환하고 사용자에게 결과 출력

## Docker daemon

- 우분투에서는 도커가 설치되면 자동으로 서비스로 등록되므로 호스트가 재시작되더라도 자동으로 실행
- 도커 데몬은 일반적으로 아래의 명령어로 시작 및 정지 가능
  ```tsx
  service docker start // 시작
  service docker stop // 정지
  ```
- service 사용하지 않고 dockerd로 직접 도커 데몬 실행도 가능
  ```tsx
  sudo dockerd

  // 명령어 확인
  sudo dockerd --help
  ```
  - 직접 도커 데몬을 실행하면 하나의 터미널을 차지하는 포그라운드(foreground) 상태로 실행되므로 운영 및 관리 측면에서 바람직하지 않고, 실제 운영 환경에서는 직접 실행하기보다는 service, systemctl 명령어를 통해 리눅스 서비스로 관리
- 직접 도커 데몬 실행
  ```tsx
  dockerd -H tcp://0.0.0.:2375 -insecure-registry=192.168.100.99:5000 -tls=false
  ```
- 서비스로 실행
  ```tsx
  DOCKER_OPTS =
    "-H tcp://0.0.0.0:2375 --insecure-registry=192.168.100.99:5000 --tls=false";
  ```
  - 두 방법 모두 도커 데몬을 설정
  - 직접 도커 데몬을 실행하는가, 서비스로 실행하는가의 차이
